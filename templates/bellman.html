{% extends "base.html" %}

<!-- This section supplements the head section of the base.html file-->
{% block head %}

<!-- This script adds a title to the banner at the top of the page. -->
<script type=text/javascript>
    divbanner = document.getElementById('divbanner');
    divbanner.innerHTML += "<center><FONT color='#ffffff' size='6'>Bellman's Cafe v1.9</FONT></center>";
</script>

<link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">


{% endblock %}

<!-- This section supplements the body section of the base.html file-->
{% block body %}

<script>

        // This code snippet was originally used to play the loading animation, when the page is loading. 
        // It might be re-employed later.
        /* 
        $(window).on("load",function(){
          $(".loader-wrapper").fadeOut("slow");
        });
        */
        
        //The loader element that contains the components of the loading animation is removed at the start of the page
        //and is rebuilt when the submit button is clicked.
        loader = document.getElementById("loader");
        $('body').removeChild(loader);
</script>

<div style= "padding-left: 20px;padding-right: 20px;padding-top: 20px;">
<!-- Title of the page-->
<h1>Welcome to Bellman's Cafe</h1>
</div>

<!-- This div represents the input section(top side) of the page.-->
<div id="divtop">

<!-- In this form element combo-boxes can be selected and input can be typed, which is submitted via the post-method.-->
<form method="post">

<div id="divbox1">
<p><label for="program"><FONT size='4'>Program:</FONT></label>
<!-- Selection box for the programs or .gap files themselves, on selection the progFunction() method is executed.-->
<!-- Almost all of the combo-boxes unintentionally have two ids, which might be the cause of why a lot of attempts failed
    to add the selected value to previously selected values.
    Although a workaround was found the duplicate ids might later be removed for a cleaner code.-->
<select id="programselect" onchange=progFunction(this) name="program" id="program">
  <!-- The default option Choose a program-->
  <option value="">Choose a program</option>
  <!-- In this script the options for programselect are created-->
  <script type=text/javascript>
    //Jinja is used to recover the gapfiles list from the return values of @app.route("/bellman") of Bellmansgap.py.
    var gapfiles = {{ gapfiles|safe }};
    //gapfiles contains the names of all the files in the working directory that end on ".gap"
    gapfiles.forEach(function(element) {
        //each filename is stripped of everything after the ".", including the "." and saved in the variable program
        //in case there was no "." in the filename, it is just saved normally
        let program = element.substring(0, element.lastIndexOf('.')) || element;
        //for each program an option is then created as html
        document.write('<option value="'+program+'">'+program+'</option>');
    });
  </script>
</select>

<span id="Downloads">
<!-- This link is used to download the selected gap file and is hidden until a gap file was selected. -->
<a href="" id="gapFileDownload" download>Download the gap file</a>
<!-- For each header file imported in the gap file, a link will be added here.-->
</span>

<!-- This div contains the hint Please select a program and is only shown before any program was selected.-->
<div id ="tip">
<FONT color = '#AF6557' size='4'><p>Please select a Program.</p></FONT>
</div>

<!-- The div for information on the programs is created as blank and will be filled on selection of a program.-->
<div id="textbox" style="visibility:hidden">
<!--
<p>
    Infotext:
</p>   
-->
</div>

<br>

<div id="exercise" style="visibility:hidden">
    <!--Your Input:-->
</div>
</div>

<!-- This script contains the progFunction() that is executed when a selection is made in the programselect combo-box.-->
<script type="text/javascript" src="{{ url_for('static', filename='javascript/progFunction.js') }}"></script>
<!-- Since 3 algebras and 2 operators appear on the page per default, the counters are set respectively.-->
<script type=text/javascript>
    var globalAlgebrasCounter = 3;
    var globalOperatorsCounter = 2;
</script>
    
<div id="divbox2" style="visibility:hidden">
<div id="algsOpInfo">
<div id="algebrasdiv">
<!-- Empty combo-boxes are created for grammar and algebra 1, they will be filled once a program is selected.-->
<p><label for="gra">Grammar:</label>

<!-- gramFunction() will be executed when the grammar selected is changed. However this is deprecated and will be changed.-->
<select id="grammarselect" onchange=gramFunction(this) name="gra" id="gra">
  <option value="">Choose a grammar</option>
</select>

</p>

<div><label for="alg1">Algebra 1:</label>

<select id="alg1select" name="alg1" id="alg1">
</select>
</div>

<div>
<!-- The operator combo-box is created staticly since it does not change. operatorFunction() is executed when a new operator is selected.-->
<span><label for="operator1">Product Operator 1:</label>

<select name="operator1" id="operator1" onchange=operatorFunction(this)>
  <option value=""></option>
  <option value="*">*</option>
  <option value="/">/</option>
  <option value="%">%</option>
  <option value="^">^</option>
  <option value=".">.</option>
  <option value="|">|</option>
</select>

<script type=text/javascript>
    function operatorFunction(operatorSelectObject) {
        
        var operatorinfo = document.getElementById("operatorinfo");
        //The operatorinfo div is reset. (which might be unnecessary here)
        //operatorinfo.innerHTML = "<p>Info:</p>";
        operatorinfo.style = "border:1px solid black;";
        operatorinfo.style.visibility = 'visible';
        
        var selectedOperator = operatorSelectObject.value;
        
    }
</script>
</span>

<!-- An empty combo-box is created for algebra 2, that will be filled when a program is selected.-->
<span><label for="alg2">Algebra 2:</label>

<select id="alg2select" name="alg2" id="alg2">
    <option value=""></option>
</select>
</span>
<span>&nbsp;</span>
</div>

<div>
<span><label for="operator2">Product Operator 2:</label>

<select name="operator2" id="operator2">
  <option value=""></option>
  <option value="*">*</option>
  <option value="/">/</option>
  <option value="%">%</option>
  <option value="^">^</option>
  <option value=".">.</option>
  <option value="|">|</option>
</select>
</span>

<span><label for="alg3">Algebra 3:</label>

<select id="alg3select" name="alg3" id="alg3">
    <option value=""></option>
</select>
</span>
</div>
<button type="button" id="addAlgebraButton" onclick="addAlgebraFunction(this)">+ Additional Algebra</button>

<script>
    function addAlgebraFunction(addAlgebraButton) {
        //The global counters for algebras and operators are incremented.
        globalAlgebrasCounter += 1;
        globalOperatorsCounter += 1;
        
        //New div is created that will hold new operator select and algebra select.
        var newAlgebraDiv = document.createElement("div");
        newAlgebraDiv.id = "algebradiv" + globalAlgebrasCounter;
        
        //Creating operator span
        var operatorSpan = document.createElement("span");
        operatorSpan.style.paddingRight = "2px";
        
        //A label is added for the operator.
        const operatorLabel = document.createElement("label");
        operatorLabel.innerHTML = "Product Operator " +  globalOperatorsCounter + ":";
        operatorLabel.setAttribute("for", "operator" + globalOperatorsCounter);
        operatorSpan.appendChild(operatorLabel);
        
        //New operator select is created and appended to the div.
        var newOperatorSelect = document.createElement("select");
        newOperatorSelect.id = "operator"+globalOperatorsCounter;
        newOperatorSelect.name = "operator"+globalOperatorsCounter;
        newOperatorSelect.style.marginLeft = "4px";
        
        //Adding options to newOperatorSelect.
        var options = ["*", "/", "%", "^", ".", "|"];
        options.forEach(function(operator) {
            var opt = document.createElement("option");
            opt.value = operator;
            opt.innerHTML = operator;
            newOperatorSelect.appendChild(opt);
        });
        
        operatorSpan.appendChild(newOperatorSelect);
        
        //Adding operatorSpan to the div
        newAlgebraDiv.appendChild(operatorSpan);
        
        
        //Creating algebraselect span
        var algSpan = document.createElement("span");
        algSpan.style.paddingLeft = "2px";
        
        //A label is added for the select element (corresponding to the number of Algebras).
        const label = document.createElement("label");
        label.innerHTML = "Algebra " +  globalAlgebrasCounter + ":";
        label.setAttribute("for", "alg" + globalAlgebrasCounter);
        algSpan.appendChild(label);
        
        //New algebra select is created and appended to the div.
        var newAlgebraSelect = document.createElement("select");
        newAlgebraSelect.id = "alg"+globalAlgebrasCounter;
        newAlgebraSelect.name = "alg"+globalAlgebrasCounter;
        newAlgebraSelect.style.marginLeft = "4px";
        algSpan.appendChild(newAlgebraSelect);
        
        //Adding algSpan to the div
        newAlgebraDiv.appendChild(algSpan);
        
        // selectedProgram is extracted from the progSelect.
        var progSelect = document.getElementById("programselect");
        var selectedProgram = progSelect.value;
        
        //algdict is imported from flask via Jinja
        var algdict = {{ algdict|safe }};
        
        //First an empty option is added:
        var emptyOption = document.createElement("option");
        emptyOption.value = "";
        emptyOption.text = "";
        newAlgebraSelect.appendChild(emptyOption);
        
        //newAlgebraSelect is populated with the algebrasList from the selectedProgram.
        algebrasList = algdict[selectedProgram].sort();
        algebrasList.forEach(function(algebraString) {
            var option = document.createElement("option");
            option.value = algebraString;
            option.text = algebraString;
            newAlgebraSelect.appendChild(option);
        });
        
        
        // The new algebra div is finally inserted before the addAlgebraButton.
        var parent = addAlgebraButton.parentElement;
        parent.insertBefore(newAlgebraDiv, addAlgebraButton);
        
        if (globalAlgebrasCounter >= 5) {
            addAlgebraButton.style.display = "none";
        }
    }
</script>

</div>
<!-- A div is created that will hold information on the selected operator.-->
<div id="operatorinfo" style="visibility:hidden">

* : The lexicographic product.
<br>
/ : The interleaved product.
<br>
% : The cartesian product.
<br>
^ : The Pareto product.
<br>
. : The take-one product. The difference to the lexicographic product is that only one co-optimal result is chosen in the case of co-optimal results.
<br>
| : The overlay product. With !A | B!, $A$ is used in the forward computation and $B$ is used during backtracing.
    
</div>
</div>

</div>


<!-- The submit button element. loadFunction() starts the loading animation and is executed when the submit button is clicked.-->
<p><button type="submit" id="submit" style="visibility:hidden" onclick="loadFunction();">Submit</button></p>

<!-- This script contains the loadFunction().-->
<script type=text/javascript>
    function loadFunction() {
        //The components of the loading animation are added to the body in html.
        //The animation is then automatically started by the css-code, namely @keyframes loader and @keyframes loader-inner.
        $('body').append('<div id="loader" class="loader-wrapper"><span class="loader"><span class="loader-inner"></span></span></div>');
    }
</script>
        
</form>

</div>

<!-- divbottomouter contains divbottom and nothing more.
    It is used to hide the results box by its visibility being hidden.
    Its visibility is set to visible at the very end of the html file.-->
<div id="divbottomouter" style="visibility:hidden">

<!-- This html section constructs the tabs
        and is (mostly) taken directly from: 
        https://makitweb.com/simple-tabbed-content-area-with-html-css-and-jquery/-->
        
<!-- divbottom contains the results section (bottom side) of the bellman page.-->    
    <div id="divbottom" class="tabs">
        <ul class="tabs-list">
            <li ><a href="#tab1">Input</a></li>
            <li ><a href="#tab2">Gapc</a></li>
            <li ><a href="#tab3">Make</a></li>
            <li class="active"><a href="#tab4">Result</a></li>
        </ul>

        <div id="tab1" class="tab">
            <p>
            <!-- This script creates the inputreminderstring for Tab 1.-->
            <script type=text/javascript>
                //The inputreminderlist is recovered via Jinja from the Flask app.
                var inputreminder = {{ inputreminderlist|safe }}
                //An inputreminderstring is built in a for loop, that contains information about the previously selected values and typed input.
                var inputreminderstring = "";
                inputreminder.forEach(function(line) {
                        inputreminderstring = inputreminderstring + line;
                    });
                inputreminderstring += "<br><div> Your Input was: "+{{exlist|safe}}+"</div><br>"
                //The inputreminderstring is then written to Tab 1.
                document.write(inputreminderstring);
            </script> 
            </p>
        </div>
        <div id="tab2" class="tab">
            <p>
            <script type=text/javascript>
                var result = {{ result|safe }}
                var resultstring = "";
                result[0].forEach(function(line){
                    resultstring = resultstring + line + "<br>";
                });
                document.write(resultstring);
            </script>
            </p>
        </div>
        <div id="tab3" class="tab">
            <p>
            <script type=text/javascript>
                var result = {{ result|safe }}
                var resultstring = "";
                result[1].forEach(function(line){
                    resultstring = resultstring + line + "<br>";
                });
                document.write(resultstring);
            </script>
            </p>
        </div>
        <div id="tab4" class="tab active">
            <p>
            <script type=text/javascript>
                var result = {{ result|safe }}
                var resultstring = "";
                result[2].forEach(function(line){
                    resultstring = resultstring + line + "<br>";
                });
                document.write(resultstring);
            </script>
            </p>
        </div>
    </div>
    
    <!-- End of tabs html section -->
    

</div>

<!-- Script for tab activation. 
    This section is taken directly from:
    https://makitweb.com/simple-tabbed-content-area-with-html-css-and-jquery/-->
<script type="text/javascript">
$(document).ready(function(){

  $(".tabs-list li a").click(function(e){
     e.preventDefault();
  });

  $(".tabs-list li").click(function(){
     var tabid = $(this).find("a").attr("href");
     $(".tabs-list li,.tabs div.tab").removeClass("active");   // removing active class from tab

     $(".tab").hide();   // hiding open tab
     $(tabid).show();    // show tab
     $(this).addClass("active"); //  adding active class to clicked tab

  });

});
</script>
<!-- End of tabs javascript section -->

<!-- This script resets the values of all the combo-boxes to the values that were selected before submit was pressed.
    This is a workaround, since selecting the values upon creation of the combo-boxes did not work.
    (Possibly due to multiple ids on the combo-boxes' html-elements.)-->
<script type=text/javascript>

    function resetValuesFunction() {
        var user_form_input = {{ user_form_input|safe }};
        
        //The values of the combo-boxes are set to the values
        //saved in user_form_input.
        var progSelect = document.getElementById("programselect");
        progSelect.value = user_form_input["program"];
        //Since the value changing is not registered by onchange in this case,
        //the onchange function progFunction() has to be executed manually.
        progFunction(progSelect);
        
        var inputstringsnumberdict = {{ inputstringsnumberdict|safe }};
        var n = inputstringsnumberdict[user_form_input["program"]];
        
        var gramSelect = document.getElementById("grammarselect");
        gramSelect.value = user_form_input["gra"];
        
        var alg1Sel = document.getElementById("alg1select");
        alg1Sel.value = user_form_input["alg1"];
        
        var operatorSel = document.getElementById("operator1");
        operatorSel.value = user_form_input["operator1"];
        //As is the case with the progFunction() of programselect, operatorFunction() has to be executed manually her too.
        operatorFunction(operatorSel);
        
        var alg2Sel = document.getElementById("alg2select");
        alg2Sel.value = user_form_input["alg2"];
        
        var operator2Sel = document.getElementById("operator2");
        operator2Sel.value = user_form_input["operator2"];
        
        var alg3Sel = document.getElementById("alg3select");
        alg3Sel.value = user_form_input["alg3"];
        
        
        var addAlgebraButton = document.getElementById("addAlgebraButton");
        
        
        if ("alg4" in user_form_input) {// && user_form_input["operator3"] != "") {
            addAlgebraFunction(addAlgebraButton);
            alg4select = document.getElementById("alg4");
            alg4select.value = user_form_input["alg4"];
            if ("operator3" in user_form_input) {
                operator3select = document.getElementById("operator3");
                operator3select.value = user_form_input["operator3"];
            }
        }
        
        if ("alg5" in user_form_input) {// && user_form_input["operator4"] != "") {
            addAlgebraFunction(addAlgebraButton);
            alg5select = document.getElementById("alg5");
            alg5select.value = user_form_input["alg5"];
            if ("operator4" in user_form_input) {
                operator4select = document.getElementById("operator4");
                operator4select.value = user_form_input["operator4"];
            }
        }
        
        if (globalAlgebrasCounter >= 5 && globalOperatorsCounter >= 4) {
            addAlgebraButton.style.display = 'none';
        }
        
        
    }
    //resetValuesFunction() is executed just before the submit button as well as after all other elements have been built.
    resetValuesFunction();
    var divbottomouter = document.getElementById("divbottomouter");
    divbottomouter.style.visibility = 'visible';
    document.getElementById('divbottom').scrollIntoView();
</script>

{% endblock %}
