{% extends "base.html" %}

<!-- This section supplements the head section of the base.html file-->
{% block head %}

<!-- This script adds a title to the banner at the top of the page. -->
<script type=text/javascript>
    version = "v1.13"
    divbanner = document.getElementById('divbanner');
    divbanner.innerHTML += "<center><FONT color='#ffffff' size='6'>Bellman's Cafe "+ version +"</FONT></center>";
    window.candidateRank = 1;
</script>

<link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">


{% endblock %}

<!-- This section supplements the body section of the base.html file-->
{% block body %}

<script>

        // This code snippet was originally used to play the loading animation, when the page is loading.
        // It might be re-employed later.
        /*
        $(window).on("load",function(){
          $(".loader-wrapper").fadeOut("slow");
        });
        */

        //The loader element that contains the components of the loading animation is removed at the start of the page
        //and is rebuilt when the submit button is clicked.
        loader = document.getElementById("loader");
        $('body').removeChild(loader);
</script>

<div style= "padding-left: 20px;padding-right: 20px;padding-top: 20px;">
<!-- Title of the page-->
<h1>Welcome to Bellman's Cafe</h1>
</div>

<!-- This div represents the input section(top side) of the page.-->
<div id="divtop">

<!-- In this form element combo-boxes can be selected and input can be typed, which is submitted via the post-method.-->
<form method="post">

<div id="divbox1">
<p><label for="program"><FONT size='4'>Program:</FONT></label>
<!-- Selection box for the programs or .gap files themselves, on selection the progFunction() method is executed.-->
<!-- Almost all of the combo-boxes unintentionally have two ids, which might be the cause of why a lot of attempts failed
    to add the selected value to previously selected values.
    Although a workaround was found the duplicate ids might later be removed for a cleaner code.-->
<select id="programselect" onchange=progFunction(this) name="program" id="program">
  <!-- The default option Choose a program-->
  <option value="">Choose a program</option>
  <!-- In this script the options for programselect are created-->
  <script type=text/javascript>
    //Jinja is used to recover the gapfiles list from the return values of @app.route("/bellman") of Bellmansgap.py.
    var gapfiles = {{ gapfiles|safe }};
    //gapfiles contains the names of all the files in the working directory that end on ".gap"
    gapfiles.forEach(function(element) {
        //each filename is stripped of everything after the ".", including the "." and saved in the variable program
        //in case there was no "." in the filename, it is just saved normally
        let program = element.substring(0, element.lastIndexOf('.')) || element;
        //for each program an option is then created as html
        document.write('<option value="'+program+'">'+program+'</option>');
    });
  </script>
</select>

<span id="Downloads">
<!-- This link is used to download the selected gap file and is hidden until a gap file was selected. -->
<a href="" id="gapFileDownload" download>Download the gap file</a>
<!-- For each header file imported in the gap file, a link will be added here.-->
</span>

<!-- This div contains the hint Please select a program and is only shown before any program was selected.-->
<div id ="tip">
<FONT color = '#AF6557' size='4'><p>Please select a Program.</p></FONT>
</div>

<!-- The div for information on the programs is created as blank and will be filled on selection of a program.-->
<div id="textbox" style="visibility:hidden">
<!--
<p>
    Infotext:
</p>
-->
</div>

<br>

<div id="exercise" style="visibility:hidden">
    <!--Your Input:-->
</div>
</div>

<!-- This script contains the progFunction() that is executed when a selection is made in the programselect combo-box.-->
<script type="text/javascript">
//This is progFunction() that is executed when a selection is made in the programselect combo-box.
function progFunction(selectProgramObject) {
    //Via Jinja the variables gramdict and algdict are recovered from the Flask app.
    var gramdict = {{ gramdict|safe }};
    var algdict = {{ algdict|safe }};
    //The selected value from the programselect is saved in a variable.
    var selectedProgram = selectProgramObject.value;

    //If the default option "Choose a program", which has the value "" was selected,
    //the alg1select, alg2select, alg3Select, operator, textbox and exercise elements are emptied to
    //return them to their default state.
    if(selectedProgram == ""){
        var alg1Select = document.getElementById("alg1select");
        while (alg1Select.firstChild) {
            alg1Select.removeChild(alg1Select.firstChild);
        }

        var operat = document.getElementById("operator1")
        operat.selectedIndex = 0;

        var alg2Select = document.getElementById("alg2select");
        while (alg2Select.firstChild) {
            alg2Select.removeChild(alg2Select.firstChild);
        }

        var operat2 = document.getElementById("operator2")
        operat2.selectedIndex = 0;

        var alg3Select = document.getElementById("alg3select");
        while (alg3Select.firstChild) {
            alg3Select.removeChild(alg3Select.firstChild);
        }

        var textbox = document.getElementById("textbox");
        textbox.innerHTML = "<p>Infotext:</p>";

        var exercisediv = document.getElementById("exercise");
        exercisediv.innerHTML="Your Input: (For example: 1+2*3)";
    }

    //Depending on the program the number of inputs can vary.
    //The default example_value is for now fixed, but should later also vary by program.
    var example_value = "\"1+2*3\"";

    //The inputstringsnumberdict is recovered via Jinja and holds the number of inputs required for every parsed program.
    var inputstringsnumberdict = {{ inputstringsnumberdict|safe }};
    //n is the number of inputs required for the selected program.
    var n = inputstringsnumberdict[selectedProgram];

    //The exercise div is intialized with a paragraph.
    var exercisediv = document.getElementById("exercise");
    exercisediv.innerHTML="Your Input: (For example 1+2*3)";

    //user_form_input is recovered via Jinja and holds the values in the combo-boxes that were selected by the user
    //and the typed input from the exercise div, before submit was pressed.
    //If submit hasn't been pressed yet this session, this dictionary is empty.
    var user_form_input = {{ user_form_input|safe }};

    //A for loop iterating n times
    for (let i = 1; i <= n; i++) {
        //If previously entered input exists for the exercises, they are used, otherwise the default value is used and saved in example_value.
        if (user_form_input.hasOwnProperty("ex"+i)) {
            example_value = user_form_input["ex"+i];
        } else {
            example_value = "\"1+2*3\"";
        }
        //The exercise elements are created with html containing the example_value as value.
        exercisediv.innerHTML+='<p><input type="text" id="ex"'+i+'" name="ex'+i+'" value = '+example_value+' /></p>';
        exercisediv.style.visibility = 'visible';
    }


    //The combo-boxes for grammar, algebras, operator as well as the textbox containing information about the program are created here.

    //The grammars and algebras that were parsed for this program are extracted from the dictionaries and saved in new variables.
    var grammarsList = gramdict[selectedProgram];
    var algebrasList = algdict[selectedProgram].sort();

    //The grammarselect combo-box is first emptied.
    var grammarSelect = document.getElementById("grammarselect");
    while (grammarSelect.firstChild) {
        grammarSelect.removeChild(grammarSelect.firstChild);
    }
    //The default option is created with a value of "" and appended.
    var defaultOption = document.createElement("option");
    defaultOption.value = "";
    defaultOption.text = "Choose a grammar";
    grammarSelect.appendChild(defaultOption);

    //For each grammar in the grammarsList for this program an option is created and appended.
    grammarsList.forEach(function(grammarString) {
        var option = document.createElement("option");
        option.value = grammarString;
        option.text = grammarString;
        grammarSelect.appendChild(option);
    });
    //The first option (after the default option) is selected.
    grammarSelect.selectedIndex = 1;

    //The algebra 1 combo-box is emptied.
    var alg1Select = document.getElementById("alg1select");
    while (alg1Select.firstChild) {
        alg1Select.removeChild(alg1Select.firstChild);
    }
    //For each algebra parsed for this program and element is created and appended.
    algebrasList.forEach(function(algebraString) {
        var option = document.createElement("option");
        option.value = algebraString;
        option.text = algebraString;
        alg1Select.appendChild(option);
    });
    //Since the first option is always selected automatically, it still works,
    //but explicitly selecting the first option would in line with the rest of the code and
    //should be added here later.

    //Since the operators stay the same and are not dependant on the program, the combo-box
    //does not need to be emtpied and rebuilt.
    //The first option of the operator combo-box is selected and its onchange-function is executed
    //in order to trigger the display of information about the operator.
    var operatorSelect = document.getElementById("operator1");
    operatorSelect.selectedIndex = 1;
    operatorFunction(operatorSelect);

    //The algebra 2 combo-box is emptied.
    var alg2Select = document.getElementById("alg2select");
    while (alg2Select.firstChild) {
        alg2Select.removeChild(alg2Select.firstChild);
    }

    //For the second operator the operator is only selected, but the infotext is not updated.
    var operatorSelect2 = document.getElementById("operator2");
    operatorSelect2.selectedIndex = 1;

    //The algebra 3 combo-box is emptied.
    var alg3Select = document.getElementById("alg3select");
    while (alg3Select.firstChild) {
        alg3Select.removeChild(alg3Select.firstChild);
    }
    //Since the user can choose to execute only one algebra, the algebra 2 and 3 combo-boxes have the empty option.
    var emptyOption = document.createElement("option");
    emptyOption.value = "";
    emptyOption.text = "";
    alg2Select.appendChild(emptyOption);
    var emptyOption2 = document.createElement("option");
    emptyOption2.value = "";
    emptyOption2.text = "";
    alg3Select.appendChild(emptyOption2);

    algebrasList = algdict[selectedProgram].sort();
    //Each parsed algebra is then added to the options of the algebra 2 and 3 combo-boxes.
    algebrasList.forEach(function(algebraString) {
        var option = document.createElement("option");
        option.value = algebraString;
        option.text = algebraString;
        alg2Select.appendChild(option);
        var option2 = document.createElement("option");
        option2.value = algebraString;
        option2.text = algebraString;
        alg3Select.appendChild(option2);
    });
    //The second algebra (after the empty option) is selected for combo-box 2, making it different from the pre-selected algebra 1 option.
    // And the third is selected for combo-box 3, making it different from the other two.
    alg2Select.selectedIndex = 2;
    alg3Select.selectedIndex = 0;

    //An infotext corresponding to the selected program is added to the textbox div.
    var infotextsdict = {{ infotextsdict|safe }};
    var infotextslist = infotextsdict[selectedProgram];
    var textbox = document.getElementById("textbox");

    textbox.innerHTML = "<p>Infotext:</p>";
    //A black border around the textbox is added.
    textbox.style = "border:1px solid black;";
    textbox.style.visibility = 'visible';

    infotextslist.forEach(function(infotext) {
            textbox.innerHTML += infotext;
        });
    // Make divbox2 and submitButton visible.
    var divbox2 = document.getElementById("divbox2");
    divbox2.style.visibility = 'visible';

    var advanced_options = document.getElementById("advanced_options");
    advanced_options.style.visibility = 'visible';

    var submitButton = document.getElementById("submit");
    submitButton.style.visibility = 'visible';

    // Make tip disappear
    var tip = document.getElementById("tip");
    tip.style.display = 'none';

    // Set download link to selectedProgram + ".gap" and set its visibility to visible.
    var gapFileName = selectedProgram + ".gap";
    var gapFileDownloadLink = document.getElementById("gapFileDownload")
    gapFileDownloadLink.href = "{{url_for('download_file', filename='replaceString')}}".replace("replaceString", gapFileName);
    gapFileDownloadLink.innerHTML = "Download " + gapFileName;
    gapFileDownloadLink.style.visibility = 'visible';

    //Remove all siblings of gapFileDownloadLink in the span.
    var downloadsSpan = document.getElementById("Downloads");
    while (gapFileDownloadLink.nextSibling) {
        downloadsSpan.removeChild(gapFileDownloadLink.nextSibling);
    }

    // Create download links for each header and add them to the span.
    var headersdict = {{ headersdict|safe }}
    var headerslist = headersdict[selectedProgram];
    for (var index in headerslist) {
        var headerFileDownloadLink = document.createElement('a');
        headerFileDownloadLink.id = "headerFileDownload";
        headerFileDownloadLink.href = "{{url_for('download_file', filename='replaceString')}}".replace("replaceString", headerslist[index].trim().replace(/['"]+/g, ''));
        headerFileDownloadLink.innerHTML = "Download " + headerslist[index].trim().replace(/['"]+/g, '');
        headerFileDownloadLink.style.visibility = 'visible';
        downloadsSpan.appendChild(headerFileDownloadLink);
    }
}
</script>
<!-- Moving the progFunction to an external file didn't work.
<script type="text/javascript" src="{{ url_for('static', filename='javascript/progFunction.js') }}"></script>
-->

<!-- Since 3 algebras and 2 operators appear on the page per default, the counters are set respectively.-->
<script type=text/javascript>
    var globalAlgebrasCounter = 3;
    var globalOperatorsCounter = 2;
</script>

<div id="divbox2" style="visibility:hidden">
<div id="algsOpInfo">
<div id="algebrasdiv">
<!-- Empty combo-boxes are created for grammar and algebra 1, they will be filled once a program is selected.-->
<p><label for="gra">Grammar:</label>

<!-- gramFunction() will be executed when the grammar selected is changed. However this is deprecated and will be changed.-->
<select id="grammarselect" onchange=gramFunction(this) name="gra" id="gra">
  <option value="">Choose a grammar</option>
</select>

</p>

<div><label for="alg1">Algebra 1:</label>

<select id="alg1select" name="alg1" id="alg1">
</select>
</div>

<div>
<!-- The operator combo-box is created staticly since it does not change. operatorFunction() is executed when a new operator is selected.-->
<span><label for="operator1">Product Operator 1:</label>

<select name="operator1" id="operator1" onchange=operatorFunction(this)>
  <option value=""></option>
  <option value="*">*</option>
  <option value="/">/</option>
  <option value="%">%</option>
  <option value="^">^</option>
  <option value=".">.</option>
  <option value="|">|</option>
</select>

<script type=text/javascript>
    function operatorFunction(operatorSelectObject) {

        var operatorinfo = document.getElementById("operatorinfo");
        //The operatorinfo div is reset. (which might be unnecessary here)
        //operatorinfo.innerHTML = "<p>Info:</p>";
        operatorinfo.style = "border:1px solid black;";
        operatorinfo.style.visibility = 'visible';

        var selectedOperator = operatorSelectObject.value;

    }
</script>
</span>

<!-- An empty combo-box is created for algebra 2, that will be filled when a program is selected.-->
<span><label for="alg2">Algebra 2:</label>

<select id="alg2select" name="alg2" id="alg2">
    <option value=""></option>
</select>
</span>
<span>&nbsp;</span>
</div>

<div>
<span><label for="operator2">Product Operator 2:</label>

<select name="operator2" id="operator2">
  <option value=""></option>
  <option value="*">*</option>
  <option value="/">/</option>
  <option value="%">%</option>
  <option value="^">^</option>
  <option value=".">.</option>
  <option value="|">|</option>
</select>
</span>

<span><label for="alg3">Algebra 3:</label>

<select id="alg3select" name="alg3" id="alg3">
    <option value=""></option>
</select>
</span>
</div>
<button type="button" id="addAlgebraButton" onclick="addAlgebraFunction(this)">+ Additional Algebra</button>

<script>
    function addAlgebraFunction(addAlgebraButton) {
        //The global counters for algebras and operators are incremented.
        globalAlgebrasCounter += 1;
        globalOperatorsCounter += 1;

        //New div is created that will hold new operator select and algebra select.
        var newAlgebraDiv = document.createElement("div");
        newAlgebraDiv.id = "algebradiv" + globalAlgebrasCounter;

        //Creating operator span
        var operatorSpan = document.createElement("span");
        operatorSpan.style.paddingRight = "2px";

        //A label is added for the operator.
        const operatorLabel = document.createElement("label");
        operatorLabel.innerHTML = "Product Operator " +  globalOperatorsCounter + ":";
        operatorLabel.setAttribute("for", "operator" + globalOperatorsCounter);
        operatorSpan.appendChild(operatorLabel);

        //New operator select is created and appended to the div.
        var newOperatorSelect = document.createElement("select");
        newOperatorSelect.id = "operator"+globalOperatorsCounter;
        newOperatorSelect.name = "operator"+globalOperatorsCounter;
        newOperatorSelect.style.marginLeft = "4px";

        //Adding options to newOperatorSelect.
        var options = ["*", "/", "%", "^", ".", "|"];
        options.forEach(function(operator) {
            var opt = document.createElement("option");
            opt.value = operator;
            opt.innerHTML = operator;
            newOperatorSelect.appendChild(opt);
        });

        operatorSpan.appendChild(newOperatorSelect);

        //Adding operatorSpan to the div
        newAlgebraDiv.appendChild(operatorSpan);


        //Creating algebraselect span
        var algSpan = document.createElement("span");
        algSpan.style.paddingLeft = "2px";

        //A label is added for the select element (corresponding to the number of Algebras).
        const label = document.createElement("label");
        label.innerHTML = "Algebra " +  globalAlgebrasCounter + ":";
        label.setAttribute("for", "alg" + globalAlgebrasCounter);
        algSpan.appendChild(label);

        //New algebra select is created and appended to the div.
        var newAlgebraSelect = document.createElement("select");
        newAlgebraSelect.id = "alg"+globalAlgebrasCounter;
        newAlgebraSelect.name = "alg"+globalAlgebrasCounter;
        newAlgebraSelect.style.marginLeft = "4px";
        algSpan.appendChild(newAlgebraSelect);

        //Adding algSpan to the div
        newAlgebraDiv.appendChild(algSpan);

        // selectedProgram is extracted from the progSelect.
        var progSelect = document.getElementById("programselect");
        var selectedProgram = progSelect.value;

        //algdict is imported from flask via Jinja
        var algdict = {{ algdict|safe }};

        //First an empty option is added:
        var emptyOption = document.createElement("option");
        emptyOption.value = "";
        emptyOption.text = "";
        newAlgebraSelect.appendChild(emptyOption);

        //newAlgebraSelect is populated with the algebrasList from the selectedProgram.
        algebrasList = algdict[selectedProgram].sort();
        algebrasList.forEach(function(algebraString) {
            var option = document.createElement("option");
            option.value = algebraString;
            option.text = algebraString;
            newAlgebraSelect.appendChild(option);
        });


        // The new algebra div is finally inserted before the addAlgebraButton.
        var parent = addAlgebraButton.parentElement;
        parent.insertBefore(newAlgebraDiv, addAlgebraButton);

        if (globalAlgebrasCounter >= 5) {
            addAlgebraButton.style.display = "none";
        }
    }
</script>

</div>
<!-- A div is created that will hold information on the selected operator.-->
<div id="operatorinfo" style="visibility:hidden">

* : The lexicographic product.
<br>
/ : The interleaved product.
<br>
% : The cartesian product.
<br>
^ : The Pareto product.
<br>
. : The take-one product. The difference to the lexicographic product is that only one co-optimal result is chosen in the case of co-optimal results.
<br>
| : The overlay product. With !A | B!, $A$ is used in the forward computation and $B$ is used during backtracing.

</div>
</div>

</div>

<div id="advanced_options" style="visibility:hidden">
  <fieldset>
    <legend>Advanced Settings</legend>

    <label for="plot_grammar">Level of detail for grammar visualization</label>
    <select id='plot_grammar' name='plot_grammar'>
      <option value="1" selected>basic (1)</option>
      <option value="2">indices (2)</option>
      <option value="3">data types (3)</option>
      <option value="4">min/max yield size (4)</option>
      <option value="5">table dimensions (5)</option>
    </select>

    <input type="checkbox" id="outside_grammar" name="outside_grammar"></input>
    <label for="outside_grammar">generate outside grammar</label>
  </fieldset>

</div>

<!-- The submit button element. loadFunction() starts the loading animation and is executed when the submit button is clicked.-->
<p><button type="submit" id="submit" style="visibility:hidden" onclick="loadFunction();">Submit</button></p>

<!-- This script contains the loadFunction().-->
<script type=text/javascript>
    function loadFunction() {
        //The components of the loading animation are added to the body in html.
        //The animation is then automatically started by the css-code, namely @keyframes loader and @keyframes loader-inner.
        $('body').append('<div id="loader" class="loader-wrapper"><span class="loader"><span class="loader-inner"></span></span></div>');
        window.candidateRank = 0;
    }
</script>

</form>

</div>

<!-- divbottomouter contains divbottom and nothing more.
    It is used to hide the results box by its visibility being hidden.
    Its visibility is set to visible at the very end of the html file.-->
<div id="divbottomouter" style="visibility:hidden">

<!-- This html section constructs the tabs
        and is (mostly) taken directly from:
        https://makitweb.com/simple-tabbed-content-area-with-html-css-and-jquery/-->

<!-- divbottom contains the results section (bottom side) of the bellman page.-->
    <div id="divbottom" class="tabs">
        <ul class="tabs-list">
            <li ><a href="#tab1" id="title_input">Input</a></li>
            <li ><a href="#tab2" id="title_gapc">Gapc</a></li>
            <li ><a href="#tab_grammar" id="title_plot">Grammar Plot</a></li>
            <li ><a href="#tab3" id='title_make'>Make</a></li>
            <li class="active" id='title_binary'><a href="#tab4">Result</a></li>
            <li style="display: visibility; width:160px" id="li_tikz"><a href="#tab_tikz" id="title_tikz">Candidate Trees</a></li>
        </ul>

        <div id="tab1" class="tab">
            <p>
            <!-- This script creates the inputreminderstring for Tab 1.-->
            <script type=text/javascript>
                //The inputreminderlist is recovered via Jinja from the Flask app.
                var inputreminder = {{ inputreminderlist|safe }}
                //An inputreminderstring is built in a for loop, that contains information about the previously selected values and typed input.
                var inputreminderstring = "";
                inputreminder.forEach(function(line) {
                        inputreminderstring = inputreminderstring + line;
                    });
                inputreminderstring += "<br><div> Your Input was: "+{{exlist|safe}}+"</div><br>"
                //The inputreminderstring is then written to Tab 1.
                document.write(inputreminderstring);
            </script>
            </p>
        </div>
        <div id="tab2" class="tab">
            <p>
            <script type=text/javascript>
                var result = {{ result|safe }}
                var resultstring = "";
                result[0][0].forEach(function(line){
                    resultstring = resultstring + line + "<br>";
                });
                document.write(resultstring);
                // TODO (smj): avoid duplication of code, which should color the out box orange iff step exited with non zero
                if (result[0][1] != "0") {
                  document.getElementById("tab2").style.backgroundColor = '#ffE1A3';
                } else {
                  document.getElementById("tab2").style.backgroundColor = null;
                }
            </script>
            </p>
        </div>
        <div id="tab_grammar" class="tab">
          <img src="" border="1" id="grammarplot" name="grammarplot" width="100%"/>
          <script type=text/javascript>
              var result = {{ result|safe }}
              var resultstring = "data:image/gif;base64,";
              if (result[4][1] != '0') {
                resultstring = 'static/error.png';
              } else {
                resultstring = resultstring + result[4][0];
              }
              document.getElementById('grammarplot').src = resultstring;
              if (result[4][1] != "0") {
                document.getElementById("tab_grammar").style.backgroundColor = '#ffE1A3';
              } else {
                document.getElementById("tab_grammar").style.backgroundColor = null;
              }
          </script>
        </div>
        <div id="tab3" class="tab">
            <p>
            <script type=text/javascript>
                var result = {{ result|safe }}
                var resultstring = "";
                result[1][0].forEach(function(line){
                    resultstring = resultstring + line + "<br>";
                });
                document.write(resultstring);
                if (result[1][1] != "0") {
                  document.getElementById("tab3").style.backgroundColor = '#ffE1A3';
                } else {
                  document.getElementById("tab3").style.backgroundColor = null;
                }
            </script>
            </p>
        </div>
        <div id="tab4" class="tab active">
            <p>
            <script type=text/javascript>
                var result = {{ result|safe }}
                var resultstring = "";
                result[2][0].forEach(function(line){
                    resultstring = resultstring + line + "<br>";
                });
                document.write(resultstring);
                if (result[2][1] != "0") {
                  document.getElementById("tab4").style.backgroundColor = '#ffE1A3';
                } else {
                  document.getElementById("tab4").style.backgroundColor = null;
                }
            </script>
            </p>
        </div>
        <div id="tab_tikz" class="tab">
          <p>
            <script type=text/javascript>
              var result = {{ result|safe }}
              // show TikZ tab when results are ready, instead of output of binary
              if (result[3][0].length > 0) {
                $(document.getElementById('tab_tikz')).addClass("active");
                $(document.getElementById("tab4")).removeClass("active");
                $(document.getElementById("title_binary")).removeClass("active");
                $(document.getElementById("li_tikz")).addClass("active");
              }
            </script>
            <table border="1" width="100%">
              <tr>
                <td style="text-align: left;"><a href="#prev" id="cand_prev" onclick="change_candidate('prev');">❮ prev</a></td>
                <th id='candidateNumber' style="text-align: center;">x of y candidate trees
                </th>
                <td style="text-align: right;"><a href="#next" id="cand_next" onclick="change_candidate('next');">next ❯</a></td>
              </tr>
              <tr>
                <td colspan=3 style="text-align: center;">
                  <img src="" border="1" id="candidateplot" name="candidateplot" style="height: 70vw; min-height: 330px;"/>
                  <script type=text/javascript>
                    var result = {{ result|safe }}
                    function showCandidate(rank) {
                      var resultstring = "";
                      if (result[3][0].length > 0) {
                        document.getElementById("li_tikz").style.display = 'visibility';
                      } else {
                        document.getElementById("li_tikz").style.display = 'none';
                      }

                      var resultstring = "data:image/gif;base64,";
                      resultstring = resultstring + result[3][0][rank-1];
                      document.getElementById('candidateplot').src = resultstring;
                      //document.getElementById('candidateNumber').innerHTML = "candidate " + window.candidateRank + " of " + result[3][0].length;

                      if (result[3][1] != "0") {
                        document.getElementById("tab_tikz").style.backgroundColor = '#ffE1A3';
                      } else {
                        document.getElementById("tab_tikz").style.backgroundColor = null;
                      }
                    }
                    function change_candidate(direction) {
                      if (direction == 'next') {
                        if (window.candidateRank < result[3][0].length) {
                          window.candidateRank += 1;
                        }
                      }
                      if (direction == 'prev') {
                        if (window.candidateRank > 1) {
                          window.candidateRank -= 1;
                        }
                      }
                      if (window.candidateRank > 1) {
                        document.getElementById("cand_prev").style.color = 'blue';
                      } else {
                        document.getElementById("cand_prev").style.color = 'gray';
                      }
                      if (window.candidateRank < result[3][0].length) {
                        document.getElementById("cand_next").style.color = 'blue';
                      } else {
                        document.getElementById("cand_next").style.color = 'gray';
                      }

                      document.getElementById('candidateNumber').innerHTML = "candidate " + window.candidateRank + " of " + result[3][0].length;
                      showCandidate(window.candidateRank);
                    }

                    change_candidate('prev');
                  </script>
                </td>
              </tr>
            </table>
          </p>
        </div>
    </div>

    <!-- End of tabs html section -->


</div>

<!-- Script for tab activation.
    This section is taken directly from:
    https://makitweb.com/simple-tabbed-content-area-with-html-css-and-jquery/-->
<script type="text/javascript">
$(document).ready(function(){

  $(".tabs-list li a").click(function(e){
     e.preventDefault();
  });

  $(".tabs-list li").click(function(){
     var tabid = $(this).find("a").attr("href");
     $(".tabs-list li,.tabs div.tab").removeClass("active");   // removing active class from tab

     $(".tab").hide();   // hiding open tab
     $(tabid).show();    // show tab
     $(this).addClass("active"); //  adding active class to clicked tab

  });

});
</script>
<!-- End of tabs javascript section -->

<!-- This script resets the values of all the combo-boxes to the values that were selected before submit was pressed.
    This is a workaround, since selecting the values upon creation of the combo-boxes did not work.
    (Possibly due to multiple ids on the combo-boxes' html-elements.)-->
<script type=text/javascript>

    function resetValuesFunction() {
        var max_num_algebras = 5;
        var user_form_input = {{ user_form_input|safe }};

        //The values of the combo-boxes are set to the values
        //saved in user_form_input.
        var progSelect = document.getElementById("programselect");
        progSelect.value = user_form_input["program"];
        //Since the value changing is not registered by onchange in this case,
        //the onchange function progFunction() has to be executed manually.
        progFunction(progSelect);

        var inputstringsnumberdict = {{ inputstringsnumberdict|safe }};
        var n = inputstringsnumberdict[user_form_input["program"]];

        var gramSelect = document.getElementById("grammarselect");
        gramSelect.value = user_form_input["gra"];

        var alg1Sel = document.getElementById("alg1select");
        alg1Sel.value = user_form_input["alg1"];

        var operatorSel = document.getElementById("operator1");
        operatorSel.value = user_form_input["operator1"];
        //As is the case with the progFunction() of programselect, operatorFunction() has to be executed manually her too.
        operatorFunction(operatorSel);

        var alg2Sel = document.getElementById("alg2select");
        alg2Sel.value = user_form_input["alg2"];

        var operator2Sel = document.getElementById("operator2");
        operator2Sel.value = user_form_input["operator2"];

        var alg3Sel = document.getElementById("alg3select");
        alg3Sel.value = user_form_input["alg3"];


        var addAlgebraButton = document.getElementById("addAlgebraButton");


        if ("alg4" in user_form_input) {// && user_form_input["operator3"] != "") {
            addAlgebraFunction(addAlgebraButton);
            alg4select = document.getElementById("alg4");
            alg4select.value = user_form_input["alg4"];
            if ("operator3" in user_form_input) {
                operator3select = document.getElementById("operator3");
                operator3select.value = user_form_input["operator3"];
            }
        }

        if ("alg5" in user_form_input) {// && user_form_input["operator4"] != "") {
            addAlgebraFunction(addAlgebraButton);
            alg5select = document.getElementById("alg5");
            alg5select.value = user_form_input["alg5"];
            if ("operator4" in user_form_input) {
                operator4select = document.getElementById("operator4");
                operator4select.value = user_form_input["operator4"];
            }
        }

        if (globalAlgebrasCounter >= max_num_algebras && globalOperatorsCounter >= max_num_algebras-1) {
            addAlgebraButton.style.display = 'none';
        }

        document.getElementById("plot_grammar").value = user_form_input['plot_grammar'];
        document.getElementById("outside_grammar").checked = user_form_input['outside_grammar'] != null;
    }
    //resetValuesFunction() is executed just before the submit button as well as after all other elements have been built.
    resetValuesFunction();
    var divbottomouter = document.getElementById("divbottomouter");
    divbottomouter.style.visibility = 'visible';
    document.getElementById('divbottom').scrollIntoView();
</script>

<span style="font-size: small;">
gapc version: <a href="https://github.com/jlab/gapc" target="_new">{{ gapc_version|safe }}</a>, ADP_collection version: <a href="https://github.com/jlab/ADP_collection/commit/{{ repo_hash|safe }}" target="_new">{{ repo_hash|safe }}</a>, cafe version: <a href="https://github.com/jlab/bellmanscafe/commit/{{ cafe_hash|safe }}" target="_new">{{ cafe_hash|safe }}</a>.
</span>
{% endblock %}
